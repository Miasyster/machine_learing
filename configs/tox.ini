[tox]
envlist = py38,py39,py310,py311,flake8,mypy,coverage
isolated_build = true

[testenv]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
    pytest-mock>=3.10.0
    pytest-asyncio>=0.21.0
    -r{toxinidir}/requirements.txt
    -r{toxinidir}/requirements-dev.txt

commands = 
    pytest {posargs:tests/} --cov=src --cov-report=term-missing --cov-report=html

[testenv:flake8]
deps = flake8>=6.0.0
commands = flake8 src/ tests/

[testenv:mypy]
deps = 
    mypy>=1.0.0
    types-requests
    types-PyYAML
commands = mypy src/ --ignore-missing-imports

[testenv:coverage]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
    coverage>=7.0.0
commands = 
    pytest tests/ --cov=src --cov-report=term-missing --cov-report=html --cov-report=xml
    coverage report --fail-under=80

[testenv:docs]
deps = 
    sphinx>=6.0.0
    sphinx-rtd-theme>=1.2.0
    sphinx-autodoc-typehints>=1.22.0
commands = 
    sphinx-build -b html docs/ docs/_build/html

[testenv:security]
deps = 
    bandit>=1.7.0
    safety>=2.3.0
commands = 
    bandit -r src/
    safety check

[testenv:format]
deps = 
    black>=23.0.0
    isort>=5.12.0
commands = 
    black src/ tests/
    isort src/ tests/

[testenv:lint]
deps = 
    flake8>=6.0.0
    black>=23.0.0
    isort>=5.12.0
    mypy>=1.0.0
commands = 
    black --check src/ tests/
    isort --check-only src/ tests/
    flake8 src/ tests/
    mypy src/ --ignore-missing-imports

[testenv:performance]
deps = 
    pytest>=7.0.0
    pytest-benchmark>=4.0.0
    memory-profiler>=0.60.0
commands = 
    pytest tests/performance/ --benchmark-only

[flake8]
max-line-length = 88
extend-ignore = E203, W503
exclude = 
    .git,
    __pycache__,
    .tox,
    .eggs,
    *.egg,
    build,
    dist,
    .venv,
    venv

[coverage:run]
source = src
omit = 
    */tests/*
    */test_*
    */__init__.py
    */conftest.py

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING: