# Airflow DAGæ¶æ„è®¾è®¡

## ğŸ“Š ç°æœ‰æ¨¡å—åˆ†æ

### 1. æ•°æ®è·å–æ¨¡å— (BinanceDataFetcher)
- **åŠŸèƒ½**: ä»å¸å®‰äº¤æ˜“æ‰€è·å–Kçº¿æ•°æ®
- **ä¸»è¦æ–¹æ³•**: 
  - `get_klines()`: è·å–å†å²Kçº¿æ•°æ®
  - `get_latest_price()`: è·å–æœ€æ–°ä»·æ ¼
- **è¾“å‡º**: æ ‡å‡†åŒ–çš„DataFrameæ ¼å¼æ•°æ®
- **ç‰¹ç‚¹**: æ”¯æŒå¤šç§æ—¶é—´é—´éš”ï¼Œå†…ç½®é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### 2. æ•°æ®å­˜å‚¨æ¨¡å— (DataStorage)
- **åŠŸèƒ½**: ç®¡ç†æ•°æ®çš„ä¿å­˜å’Œè¯»å–
- **ä¸»è¦æ–¹æ³•**:
  - `save_klines_data()`: ä¿å­˜Kçº¿æ•°æ®
  - `load_klines_data()`: åŠ è½½Kçº¿æ•°æ®
  - `append_data()`: å¢é‡æ•°æ®è¿½åŠ 
- **ç‰¹ç‚¹**: æ”¯æŒCSVå’ŒParquetæ ¼å¼ï¼Œè‡ªåŠ¨ç›®å½•ç®¡ç†

### 3. æ•°æ®æ¸…æ´—æ¨¡å— (DataCleaner)
- **åŠŸèƒ½**: æ•°æ®è´¨é‡å¤„ç†å’Œæ¸…æ´—
- **ä¸»è¦æ–¹æ³•**:
  - `clean_data_pipeline()`: å®Œæ•´æ¸…æ´—æµæ°´çº¿
  - `fill_missing_values()`: ç¼ºå¤±å€¼å¤„ç†
  - `detect_outliers()`: å¼‚å¸¸å€¼æ£€æµ‹
- **ç‰¹ç‚¹**: é›†æˆæ•°æ®å®Œæ•´æ€§æ£€æŸ¥ï¼Œæ”¯æŒå¤šç§æ¸…æ´—ç­–ç•¥

### 4. æ•°æ®å®Œæ•´æ€§æ£€æŸ¥æ¨¡å— (DataIntegrityChecker)
- **åŠŸèƒ½**: æ•°æ®è´¨é‡éªŒè¯å’Œå®Œæ•´æ€§æ£€æŸ¥
- **ä¸»è¦æ–¹æ³•**:
  - `comprehensive_integrity_check()`: ç»¼åˆå®Œæ•´æ€§æ£€æŸ¥
  - `check_date_continuity()`: æ—¥æœŸè¿ç»­æ€§æ£€æŸ¥
  - `check_ohlc_logic()`: OHLCä»·æ ¼é€»è¾‘æ£€æŸ¥
- **ç‰¹ç‚¹**: å¤šç»´åº¦æ•°æ®è´¨é‡è¯„ä¼°ï¼Œç”Ÿæˆè¯¦ç»†æŠ¥å‘Š

### 5. ç‰¹å¾å·¥ç¨‹æ¨¡å— (FeatureEngineer)
- **åŠŸèƒ½**: æŠ€æœ¯æŒ‡æ ‡è®¡ç®—å’Œç‰¹å¾ç”Ÿæˆ
- **ä¸»è¦æ–¹æ³•**:
  - `calculate_feature()`: å•ä¸ªç‰¹å¾è®¡ç®—
  - `calculate_multiple_features()`: æ‰¹é‡ç‰¹å¾è®¡ç®—
- **ç‰¹ç‚¹**: æ”¯æŒ15+ç§æŠ€æœ¯æŒ‡æ ‡ï¼Œå¯æ‰©å±•æ¶æ„

## ğŸ—ï¸ Airflow DAGæ¶æ„è®¾è®¡

### DAGä¾èµ–å…³ç³»å›¾
```
æ•°æ®è·å–DAG (data_ingestion_dag)
    â†“
æ•°æ®è´¨é‡æ£€æŸ¥DAG (data_quality_dag)
    â†“
æ•°æ®æ¸…æ´—DAG (data_cleaning_dag)
    â†“
ç‰¹å¾å·¥ç¨‹DAG (feature_engineering_dag)
    â†“
æ•°æ®éªŒè¯DAG (data_validation_dag)
```

### 1. æ•°æ®è·å–DAG (data_ingestion_dag)
**è°ƒåº¦é¢‘ç‡**: æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
**ä»»åŠ¡æµç¨‹**:
```
start_task
    â†“
check_api_connection
    â†“
fetch_btc_data â†’ fetch_eth_data â†’ fetch_bnb_data (å¹¶è¡Œ)
    â†“
validate_raw_data
    â†“
save_raw_data
    â†“
end_task
```

**ä»»åŠ¡è¯¦æƒ…**:
- `check_api_connection`: éªŒè¯Binance APIè¿æ¥
- `fetch_*_data`: è·å–å„å¸ç§çš„Kçº¿æ•°æ®
- `validate_raw_data`: åŸå§‹æ•°æ®åŸºç¡€éªŒè¯
- `save_raw_data`: ä¿å­˜åˆ°å­˜å‚¨ç³»ç»Ÿ

### 2. æ•°æ®è´¨é‡æ£€æŸ¥DAG (data_quality_dag)
**è°ƒåº¦é¢‘ç‡**: æ•°æ®è·å–å®Œæˆåè§¦å‘
**ä»»åŠ¡æµç¨‹**:
```
start_task
    â†“
load_latest_data
    â†“
date_continuity_check â†’ ohlc_logic_check â†’ volume_logic_check (å¹¶è¡Œ)
    â†“
generate_quality_report
    â†“
quality_alert_check
    â†“
end_task
```

### 3. æ•°æ®æ¸…æ´—DAG (data_cleaning_dag)
**è°ƒåº¦é¢‘ç‡**: æ•°æ®è´¨é‡æ£€æŸ¥é€šè¿‡åè§¦å‘
**ä»»åŠ¡æµç¨‹**:
```
start_task
    â†“
load_raw_data
    â†“
missing_value_handling
    â†“
outlier_detection
    â†“
time_series_alignment
    â†“
integrity_check
    â†“
save_cleaned_data
    â†“
end_task
```

### 4. ç‰¹å¾å·¥ç¨‹DAG (feature_engineering_dag)
**è°ƒåº¦é¢‘ç‡**: æ•°æ®æ¸…æ´—å®Œæˆåè§¦å‘
**ä»»åŠ¡æµç¨‹**:
```
start_task
    â†“
load_cleaned_data
    â†“
price_features â†’ volume_features â†’ volatility_features (å¹¶è¡Œ)
    â†“
technical_indicators
    â†“
feature_validation
    â†“
save_features
    â†“
end_task
```

### 5. æ•°æ®éªŒè¯DAG (data_validation_dag)
**è°ƒåº¦é¢‘ç‡**: ç‰¹å¾å·¥ç¨‹å®Œæˆåè§¦å‘
**ä»»åŠ¡æµç¨‹**:
```
start_task
    â†“
load_feature_data
    â†“
feature_quality_check
    â†“
data_drift_detection
    â†“
generate_final_report
    â†“
send_notifications
    â†“
end_task
```

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### 1. ä»»åŠ¡åŒ…è£…å™¨è®¾è®¡
- ä¸ºæ¯ä¸ªç°æœ‰æ¨¡å—åˆ›å»ºAirflowä»»åŠ¡åŒ…è£…å™¨
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- å‚æ•°åŒ–é…ç½®æ”¯æŒ

### 2. æ•°æ®ä¼ é€’æœºåˆ¶
- ä½¿ç”¨XComä¼ é€’å°é‡å…ƒæ•°æ®
- æ–‡ä»¶ç³»ç»Ÿä¼ é€’å¤§é‡æ•°æ®
- æ•°æ®è·¯å¾„æ ‡å‡†åŒ–

### 3. é”™è¯¯å¤„ç†ç­–ç•¥
- ä»»åŠ¡çº§åˆ«é‡è¯•æœºåˆ¶
- æ•°æ®è´¨é‡é˜ˆå€¼å‘Šè­¦
- å¤±è´¥ä»»åŠ¡é€šçŸ¥

### 4. ç›‘æ§å’Œå‘Šè­¦
- æ•°æ®è´¨é‡æŒ‡æ ‡ç›‘æ§
- ä»»åŠ¡æ‰§è¡Œæ—¶é—´ç›‘æ§
- å¼‚å¸¸æƒ…å†µè‡ªåŠ¨å‘Šè­¦

## ğŸ“‹ é…ç½®ç®¡ç†

### 1. DAGé…ç½®
- è°ƒåº¦æ—¶é—´é…ç½®
- é‡è¯•ç­–ç•¥é…ç½®
- ä¾èµ–å…³ç³»é…ç½®

### 2. æ•°æ®æºé…ç½®
- APIè¿æ¥é…ç½®
- æ•°æ®å­˜å‚¨è·¯å¾„é…ç½®
- æ•°æ®æ ¼å¼é…ç½®

### 3. è´¨é‡é˜ˆå€¼é…ç½®
- æ•°æ®å®Œæ•´æ€§é˜ˆå€¼
- ç‰¹å¾è´¨é‡é˜ˆå€¼
- å‘Šè­¦è§¦å‘æ¡ä»¶

## ğŸš€ éƒ¨ç½²è€ƒè™‘

### 1. èµ„æºéœ€æ±‚
- CPU: ä¸­ç­‰è®¡ç®—éœ€æ±‚
- å†…å­˜: æ•°æ®å¤„ç†éœ€è¦è¶³å¤Ÿå†…å­˜
- å­˜å‚¨: å†å²æ•°æ®å­˜å‚¨éœ€æ±‚

### 2. æ‰©å±•æ€§
- æ”¯æŒæ–°å¢æ•°æ®æº
- æ”¯æŒæ–°å¢ç‰¹å¾æŒ‡æ ‡
- æ”¯æŒå¤šç¯å¢ƒéƒ¨ç½²

### 3. å¯ç»´æŠ¤æ€§
- æ¨¡å—åŒ–è®¾è®¡
- æ ‡å‡†åŒ–æ¥å£
- å®Œå–„çš„æ–‡æ¡£å’Œæµ‹è¯•